# see orb options at
# https://github.com/cypress-io/circleci-orb
version: 2.1
orbs:
  cypress: cypress-io/cypress@1
workflows:
  build:
    jobs:
      - cypress/install:
          pre-steps:
            - run: npm config set unsafe-perm true
      - cypress/run:
          requires:
            - cypress/install
          executor: cypress/base-10
          no-workspace: true
          start: npm run start:coverage
          wait-on: http://localhost:4100
          record: true
          post-steps:
            - store_artifacts:
                path: coverage
            - run: npx nyc report --reporter=text
            # send code coverage to coveralls.io
            # https://coveralls.io/github/bahmutov/realworld
            - run: npm run coveralls
